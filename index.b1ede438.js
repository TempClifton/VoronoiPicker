class e{constructor(e,t,o){let i={h:lm.RandomInt(0,255),s:lm.RandomInt(128,255),v:lm.RandomInt(64,255),a:255},s=new lm.RgbColor;s.FromHSVColor(i);let a=s.IntegerToFloatColor();this.voronoiColor=new THREE.Color(a.r,a.g,a.b),this.model=e,this.startPos=t,this.shiftX=lm.RandomFloat(-10,10),this.shiftY=lm.RandomFloat(-10,10),this.shiftZ=lm.RandomFloat(-10,10),this.scaleX=lm.RandomFloat(.1,1),this.scaleY=lm.RandomFloat(.1,1),this.scaleZ=lm.RandomFloat(.1,1),this.runningPickAnimation=!1,this.cornerDots=[];for(let e=0;e<8;e++){let e=new THREE.SphereGeometry(2,10,10),t=new THREE.MeshBasicMaterial({color:16711680}),i=new THREE.Mesh(e,t);i.position.set(lm.RandomFloat(0,1e3),lm.RandomFloat(0,1e3),0),o.add(i),this.cornerDots.push(i)}}UpdateHitTargets(e){let t=e.canvasWidth/2,o=e.canvasHeight/2;const i=(new THREE.Box3).setFromObject(this.model,!0);let s=new THREE.Vector3;for(let a=0;a<8;a++){switch(a){case 0:s.set(i.min.x,i.min.y,i.min.z);break;case 1:s.set(i.min.x,i.min.y,i.max.z);break;case 2:s.set(i.min.x,i.max.y,i.min.z);break;case 3:s.set(i.min.x,i.max.y,i.max.z);break;case 4:s.set(i.max.x,i.min.y,i.min.z);break;case 5:s.set(i.max.x,i.min.y,i.max.z);break;case 6:s.set(i.max.x,i.max.y,i.min.z);break;case 7:s.set(i.max.x,i.max.y,i.max.z)}s.project(e.camera),s.x=s.x*t+t,s.y=-s.y*o+o,this.cornerDots[a].position.copy(s)}}Pick(e){this.runningPickAnimation||(this.pickStartTime=e,this.runningPickAnimation=!0,this.startScale=this.model.scale.clone())}Animate(e,t,o){let i=this;if(i.model.rotation.x=Math.sin(e+i.shiftX),i.model.rotation.y=Math.sin(e+i.shiftY),i.model.rotation.z=Math.sin(e+i.shiftZ),i.model.position.copy(i.startPos),i.model.position.x+=10*Math.sin(e*i.scaleX+i.shiftX),i.model.position.y+=10*Math.sin(e*i.scaleY+i.shiftY),i.model.position.z+=10*Math.sin(e*i.scaleZ+i.shiftZ),this.runningPickAnimation)if(this.model.scale.copy(this.startScale),e-this.pickStartTime<2){let t=(e-this.pickStartTime)/2;t*=2*Math.PI,t=1+4*(1-Math.cos(t)),this.model.scale.multiplyScalar(t)}else this.runningPickAnimation=!1;o&&this.UpdateHitTargets(t)}}class t extends lm.ThreeApp{constructor(){super(),this.showSamplePts=!1,this.showHitRegions=!1,this.BACKGROUND_COLOR=7173266,this.models=[]}LoadModel(t,o,i,s){(new THREE.GLTFLoader).load("static/models/"+t,function(t){let a=t.scene,n=a.parent;a.parent=null,a.updateMatrixWorld(!0);let l=new THREE.Vector3;const r=(new THREE.Box3).setFromObject(a);r.getCenter(l),l.multiplyScalar(-1),a.parent=n;let h=i/(r.max.y-r.min.y);l.multiplyScalar(h),a.position.copy(l),a.scale.setScalar(h);for(let t=0;t<o;t++)t>0&&(a=a.clone()),a.position.copy(l),a.position.x+=lm.RandomFloat(-s,s),a.position.y+=lm.RandomFloat(-s,s),a.position.z+=lm.RandomFloat(-s,s),this.models.push(new e(a,l,this.overlayPointGroup)),this.userGroup.add(a);this.AutoSetCamera(),this.camera.near=.01,this.camera.far=100,this.camera.updateProjectionMatrix(),t.animations,t.scene,t.scenes,t.cameras,t.asset}.bind(this),(function(e){}),(function(e){console.log("An error happened"),console.log(e)}))}SetupScene(){this.foo=!0,this.settings=QuickSettings.create(10,10,"Voronoi Picker").setDraggable(!0).setCollapsible(!0).addBoolean("Show Points",this.showSamplePts,function(e){this.showSamplePts=e,this.showSamplePts?this.overlayScene.add(this.overlayPointGroup):this.overlayScene.remove(this.overlayPointGroup)}.bind(this)).addBoolean("Show Targets",this.showHitRegions,function(e){this.showHitRegions=e,this.showHitRegions?this.overlayScene.add(this.overlayCellGroup):this.overlayScene.remove(this.overlayCellGroup)}.bind(this)),this.renderer.toneMapping=THREE.ACESFilmicToneMapping,this.renderer.toneMappingExposure=2,this.renderer.outputEncoding=THREE.sRGBEncoding,(new THREE.RGBELoader).load("static/textures/equirectangular/venice_sunset_1k.hdr",function(e){e.mapping=THREE.EquirectangularReflectionMapping,this.scene.environment=e}.bind(this)),this.CreateOverlay(),this.overlayPointGroup=new THREE.Group,this.overlayCellGroup=new THREE.Group,this.LoadModel("Truck.glb",1,5,0),this.LoadModel("Acorn.glb",15,1,20),this.LoadModel("DamagedHelmet.gltf",1,5,20),this.LoadModel("PineTree.glb",15,1,20)}OnClick(e,t){let o=!1;this.showHitRegions||(o=!0,this.showHitRegions=!0,this.overlayScene.add(this.overlayCellGroup),this.GenerateVoronoiDiagram(),this.Render(!0)),this.raycaster=new THREE.Raycaster;let i=new THREE.Vector2;i.x=t.x/this.canvasDiv.clientWidth*2-1,i.y=-t.y/this.canvasDiv.clientHeight*2+1,this.raycaster.setFromCamera(i,this.overlayCamera);let s=this.raycaster.intersectObject(this.overlayCellGroup,!0);o&&(this.showHitRegions=!1,this.overlayScene.remove(this.overlayCellGroup),this.Render(!0)),s.length>0&&void 0!==s[0].object.modelID&&this.models[s[0].object.modelID].Pick(this.mainTimer.ElapsedTime())}GenerateVoronoiDiagram(){let e=new Voronoi,t={xl:0,xr:this.canvasWidth,yt:0,yb:this.canvasHeight},o=[];for(let e=0;e<this.models.length;e++){let t=this.models[e];for(let i=0;i<8;i++){let s={x:lm.Round(t.cornerDots[i].position.x),y:lm.Round(t.cornerDots[i].position.y),modelID:e};o.push(s)}}let i=e.compute(o,t);if(this.showHitRegions){for(let e of this.overlayCellGroup.children)e.geometry.dispose(),e.material.dispose();this.overlayCellGroup.clear();for(let e of i.cells){if(!e.halfedges||0==e.halfedges.length)continue;let t=e.halfedges[0].getStartpoint(),o=new THREE.Shape;o.moveTo(t.x,t.y);for(let t=0;t<e.halfedges.length;t++){let i=e.halfedges[t].getEndpoint();o.lineTo(i.x,i.y)}const i=new THREE.ShapeGeometry(o);let s=this.models[e.site.modelID].voronoiColor;const a=new THREE.MeshBasicMaterial({color:s,side:THREE.DoubleSide,opacity:.25,transparent:!0}),n=new THREE.Mesh(i,a);n.modelID=e.site.modelID,this.overlayCellGroup.add(n)}}}UpdateScene(){let e=this.showSamplePts||this.showHitRegions,t=this.mainTimer.ElapsedTime();for(let o of this.models)o.Animate(t,this,e);this.showHitRegions&&this.GenerateVoronoiDiagram()}}let o=null;lm.AddLoadEvent((function(){lm.DEBUG=!1,o=new t,o.SetupThreeJS(),o.SetupScene()}));
//# sourceMappingURL=index.b1ede438.js.map
