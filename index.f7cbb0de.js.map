{"mappings":"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","sources":["../js/lm_src/lm_domsupport.js"],"sourcesContent":["'use strict';\n\n//***********************************************************************************\n//*** Utility functions for manipulationg DOM objects\n//***********************************************************************************\n\n/**\n * Allow tab key events in a textarea element.\n * @param {Object} elem An element in the page. This should be a textarea for everything to work as expected.\n */\nlm.AllowTabsInTextArea = function(elem)\n{\n\telem.onkeydown = function(ev)\n\t{\n\t\tif (ev.keyCode == 9 || ev.which == 9)\n\t\t{\n\t\t    /* This code is supposed to handle tabbing and shift-tabbing multiple lines\n\t\t\tlet keyCode = ev.keyCode || ev.which;\n\n\t\t    if (keyCode == 9) {\n\t\t        ev.preventDefault();\n\t\t        let start = this.selectionStart;\n\t\t        let end = this.selectionEnd;\n\t\t        let val = this.value;\n\t\t        let selected = val.substring(start, end);\n\t\t        let re, count;\n\n\t\t        if(ev.shiftKey) {\n\t\t            re = /^\\t/gm;\n\t\t            count = -selected.match(re).length;\n\t\t            this.value = val.substring(0, start) + selected.replace(re, '') + val.substring(end);\n\t\t            // todo: add support for shift-tabbing without a selection\n\t\t        } else {\n\t\t            re = /^/gm;\n\t\t            count = selected.match(re).length;\n\t\t            this.value = val.substring(0, start) + selected.replace(re, '\\t') + val.substring(end);\n\t\t        }\n\n\t\t        if(start === end) {\n\t\t            this.selectionStart = end + count;\n\t\t        } else {\n\t\t            this.selectionStart = start;\n\t\t        }\n\n\t\t        this.selectionEnd = end + count;\n\t\t    }*/\n\t\t\tevent.preventDefault();\n\t\t\tlet v = this.value, s = this.selectionStart, e = this.selectionEnd;\n\t\t\tconsole.log(s);\n\t\t\tconsole.log(e);\n\t\t\tlet newValue = v.substring(0, s) + '\\t' + v.substring(e);\n\t\t\tthis.value = newValue;\n\t\t\tthis.selectionStart = this.selectionEnd = s + 1;\n\t\t\treturn false;\n\t\t}\n\t};\n}\n\n/**\n * Converts page coordinates to element client coordinates. Useful for dealing with mouse events.\n * @param {Object} elem An element in the page. Often this is a canvas element.\n * @param {number} pageX An X coordinate in the page's coordinate system.\n * @param {number} pageY A Y coordinate in the page's coordinate system.\n * @returns {Object} An object with two properties, x and y. This is the same point in the element's client coordinate system.\n */\nlm.PageToElemCoords = function(elem, pageX, pageY)\n{\n/*\n\t// My old method - it's bad and doesn't handle div containers with scrolling, parent divs with padding, etc.\n\treturn { x: pageX - elem.offsetLeft, y: pageY - elem.offsetTop };\n*/\n/*\n\t// An improved method - takes into account parent elements, but is slow and may be buggy in some browsers.\n\t// (Also, it may not take into account parent elements with scrollbars.)\n\tlet top=0, left=0;\n\n\twhile(elem)\n\t{\n\t\ttop = top + parseInt(elem.offsetTop);\n\t\tleft = left + parseInt(elem.offsetLeft);\n\t\telem = elem.offsetParent;\n\t}\n\n\treturn { x: pageX - left, y: pageY - top };\n*/\n\n\t// Newset method. Reference - http://javascript.info/tutorial/coordinates\n\t// Get the enclosing rectangle.\n\tlet box = elem.getBoundingClientRect();\n\n\tlet body = document.body;\n\tlet docElem = document.documentElement;\n\n\t// Calculate the page scroll.\n\t// All browsers except IE<9 support 'pageXOffset/pageYOffset', and in IE when DOCTYPE is set,\n\t// the scroll can be taken from documentElement(<html>), otherwise from 'body' - so we take what we can.\n\tlet scrollTop = window.pageYOffset || docElem.scrollTop || body.scrollTop;\n\tlet scrollLeft = window.pageXOffset || docElem.scrollLeft || body.scrollLeft;\n\n\t// The document ('html' or 'body') can be shifted from left-upper corner in IE. Get the shift.\n\tlet clientTop = docElem.clientTop || body.clientTop || 0;\n\tlet clientLeft = docElem.clientLeft || body.clientLeft || 0;\n\n\t// Add scrolls to window-relative coordinates and substract the shift of 'html/body' to get coordinates in the whole document.\n\tlet top  = Math.round(box.top + scrollTop - clientTop);\n\tlet left = Math.round(box.left + scrollLeft - clientLeft);\n\n\treturn { x: pageX - left, y: pageY - top };\n\n}\n\n/**\n * Returns the offset of an element relative to the page coordinate system.\n * @param {Object} elem An element in the page. Often this is a canvas element.\n * @returns {Object} An object with two properties, x and y. This is the offset of the element in page coordinates.\n */\nlm.ElemPageOffset = function(elem)\n{\n\t// Newset method. Reference - http://javascript.info/tutorial/coordinates\n\t// Get the enclosing rectangle.\n\tlet box = elem.getBoundingClientRect();\n\n\tlet body = document.body;\n\tlet docElem = document.documentElement;\n\n\t// Calculate the page scroll.\n\t// All browsers except IE<9 support 'pageXOffset/pageYOffset', and in IE when DOCTYPE is set,\n\t// the scroll can be taken from documentElement(<html>), otherwise from 'body' - so we take what we can.\n\tlet scrollTop = window.pageYOffset || docElem.scrollTop || body.scrollTop;\n\tlet scrollLeft = window.pageXOffset || docElem.scrollLeft || body.scrollLeft;\n\n\t// The document ('html' or 'body') can be shifted from left-upper corner in IE. Get the shift.\n\tlet clientTop = docElem.clientTop || body.clientTop || 0;\n\tlet clientLeft = docElem.clientLeft || body.clientLeft || 0;\n\n\t// Add scrolls to window-relative coordinates and substract the shift of 'html/body' to get coordinates in the whole document.\n\tlet top  = Math.round(box.top + scrollTop - clientTop);\n\tlet left = Math.round(box.left + scrollLeft - clientLeft);\n\n\treturn { x: left, y: top };\n\n}\n\n/**\n * Tests whether a point (a mouse point) is inside an element.\n * @param {number} elem An element in the page.\n * @param {number} pageX X coordinate in page space.\n * @param {number} pageY Y coordinate in page space.\n * @returns {boolean} True or false.\n */\nlm.PagePointInElem = function(elem, pageX, pageY)\n{\n\tlet pt = lm.PageToElemCoords(elem, pageX, pageY);\n\tif (pt.x >= 0 && pt.y >= 0 && pt.x <= elem.offsetWidth && pt.y <= elem.offsetHeight)\n\t\treturn true;\n\telse\n\t\treturn false;\n}\n\n/**\n * Tests whether an element is a text input box.\n * @param {Object} elem An element in the page.\n * @returns {boolean} True or false.\n */\nlm.IsTextBox = function(elem)\n{\n\tlet tagName = elem.tagName.toLowerCase();\n\tif (tagName === 'textarea')\n\t\treturn true;\n\tif (tagName !== 'input')\n\t\treturn false;\n\tlet type = elem.getAttribute('type').toLowerCase();\n\t// if any of these input types is not supported by a browser, it will behave as input type text.\n\tlet inputTypes = ['text', 'password', 'number', 'email', 'tel', 'url', 'search', 'date', 'datetime', 'datetime-local', 'time', 'month', 'week'];\n\treturn inputTypes.indexOf(type) >= 0;\n}\n\n/**\n * Toggles a dropdown element visible or invisible.\n * @param {string|Object} id The element id of the dropdown to show or hide. Or, it can be an actual element object.\n */\nlm.ToggleDropdown = function(id)\n{\n\tlet e = id;\n\tif (typeof(e) == \"string\")\n\t\te = document.getElementById(id);\n\tlm.Assert(e, \"Unknown dropdown element\");\n\tlet showing = e.classList.contains('show');\n\tif (showing)\n\t\te.style.opacity = 1.0;\n\telse\n\t\te.style.opacity = 0.0;\n\tif (showing)\n\t{\n\t\tlm.FadeOut(e, 0.1, function()\n\t\t{\n\t\t\te.classList.toggle(\"show\");\n\t\t\tif (lm.DropdownShowingChange) // optional callback function to do something when dropdowns come and go\n\t\t\t\tlm.DropdownShowingChange(false);\n\t\t});\n\t}\n\telse\n\t{\n\t\tif (lm.DropdownShowingChange) // optional callback function to do something when dropdowns come and go\n\t\t\tlm.DropdownShowingChange(true);\n\t\te.classList.toggle(\"show\");\n\t\tlm.FadeIn(e, 0.1);\n\t}\n}\n\n/**\n * Toggles an element visible or invisible.\n * @param {string|Object} id The element id of the element to show or hide. Or, it can be an actual element object.\n */\nlm.ToggleVisibility = function(id)\n{\n\tlet e = id;\n\tif (typeof(e) == \"string\")\n\t\te = document.getElementById(id);\n\tlet visible = (e.style.visibility == \"visible\");\n\tif (visible)\n\t\te.style.opacity = 1.0;\n\telse\n\t\te.style.opacity = 0.0;\n\tif (visible)\n\t{\n\t\tlm.FadeOut(e, 0.25, function()\n\t\t{\n\t\t\te.style.visibility = \"hidden\";\n\t\t});\n\t}\n\telse\n\t{\n\t\te.style.visibility = \"visible\";\n\t\tlm.FadeIn(e, 0.25);\n\t}\n}\n\n/**\n * Fades in an HTML element over time.\n * @param {Object} elem The element to fade in.\n * @param {number} secs The number of seconds for the fade to take.\n * @param {function} [callback] A function to be called at the end of the fade.\n */\nlm.FadeIn = function(elem, secs, callback)\n{\n    elem.style.display = \"\";\n\tlet opacity = 0;\n\tlet timer = setInterval(function()\n\t{\n\t\tif (opacity >= 1)\n\t\t{\n\t\t\tclearInterval(timer);\n\t\t\tif (callback)\n\t\t\t\tcallback();\n\t\t}\n\t\telem.style.opacity = opacity.toFixed(4);\n\t\topacity += (1 / 30) / secs;\n\t}, 1000 / 30);\n}\n\n/**\n * Fades out an HTML element over time.\n * @param {Object} elem The element to fade out.\n * @param {number} secs The number of seconds for the fade to take.\n * @param {function} [callback] A function to be called at the end of the fade.\n */\nlm.FadeOut = function(elem, secs, callback)\n{\n\tlet opacity = 1;\n\tlet timer = setInterval(function()\n\t{\n\t\tif (opacity <= 0)\n\t\t{\n\t\t\tclearInterval(timer);\n\t\t\telem.style.display = \"none\";\n\t\t\tif (callback)\n\t\t\t\tcallback();\n\t\t}\n\t\telem.style.opacity = opacity.toFixed(4);\n\t\topacity -= (1 / 30) / secs;\n\t}, 1000 / 30);\n}\n\n/**\n * Returns true if an input element has keyboard focus.\n */\nlm.InputHasFocus = function()\n{\n\tif (\n\t\tdocument.hasFocus() &&\n\t\tdocument.activeElement &&\n\t\tdocument.activeElement !== document.body &&\n\t\tdocument.activeElement !== document.documentElement\n\t)\n\t{\n\t\tlet elType = document.activeElement.nodeName.toLowerCase();\n\t\tif (elType == \"input\" || elType == \"lm-number\")\n\t\t\treturn true;\n\t}\n\treturn false;\n}\n\n/**\n * Toggles fullscreen mode on or off.\n */\nlm.ToggleFullscreen = function()\n{\n\t// Full Screen support on iOS is only available starting on iPad, mobile Safari, iOS version 12.\n\t// The following code can be used to identify this situation, and hide a \"full-screen\" button if\n\t// the device doesn't support it. I'm not currently doing this - hoping it won't be necessary\n\t// and that more and more devices/browsers will just support full-screen mode.\n\t// Found this code here: https://dev.to/marvindanig/fullscreen-web-apps-on-ipad-safari--3p9b\n// const userAgent = window.navigator.userAgent;\n//\n// const iPadSafari =\n//     !!userAgent.match(/iPad/i) &&       // Detect iPad first.\n//     !!userAgent.match(/WebKit/i) &&     // Filter browsers with webkit engine only\n//     !userAgent.match(/CriOS/i) &&       // Eliminate Chrome & Brave\n//     !userAgent.match(/OPiOS/i) &&       // Rule out Opera\n//     !userAgent.match(/FxiOS/i) &&       // Rule out Firefox\n//     !userAgent.match(/FocusiOS/i);      // Eliminate Firefox Focus as well!\n//\n// const element = document.getElementById('fullScreenButton');\n//\n// function iOS() {\n//     if (userAgent.match(/ipad|iphone|ipod/i)) {\n//         const iOS = {};\n//         iOS.majorReleaseNumber = +userAgent.match(/OS (\\d)?\\d_\\d(_\\d)?/i)[0].split('_')[0].replace('OS ', '');\n//         return iOS;\n//     }\n// }\n//\n// if (element !== null) {\n//     if (userAgent.match(/iPhone/i) || userAgent.match(/iPod/i)) {\n//         element.className += ' hidden';\n//     } else if (userAgent.match(/iPad/i) && iOS().majorReleaseNumber < 12) {\n//         element.className += ' hidden';\n//     } else if (userAgent.match(/iPad/i) && !iPadSafari) {\n//         element.className += ' hidden';\n//     } else {\n//         element.addEventListener('click', _toggleFullScreen, false);\n//     }\n// }\n\n    if (document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement) {\n        if (document.cancelFullScreen) {\n            document.cancelFullScreen();\n        } else {\n            if (document.mozCancelFullScreen) {\n                document.mozCancelFullScreen();\n            } else {\n                if (document.webkitCancelFullScreen) {\n                    document.webkitCancelFullScreen();\n                }\n            }\n        }\n    } else {\n        const _element = document.documentElement;\n        if (_element.requestFullscreen) {\n            _element.requestFullscreen();\n        } else {\n            if (_element.mozRequestFullScreen) {\n                _element.mozRequestFullScreen();\n            } else {\n                if (_element.webkitRequestFullscreen) {\n                    _element.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n                }\n            }\n        }\n    }\n}\n\n/*\n\tFunction: lm.E\n\t\tA simple shortcut for accessing DOM elements by id string.\n*/\nlm.E = function(id)\n{\n\treturn document.getElementById(id);\n}\n\n/*\n\tFunction: lm.ConnectMouseEvents\n\t\tSets up mouse and touch callback events. After calling this function, the user-created callbackObj\n\t\twill have its \"virtual\" functions called for mouse down, mouse moved, and mouse up events.\n\t\tHandles mouse, touch, and stylus events, as well as when the mouse moves outside of the element or event the window.\n\n\t\t*** NOTE ***\n\t\tSee the default options object below for options that can be applied when using this function.\n\n\t\tSample usage in lm-number, a LitElement component:\n\t\t\tconnectedCallback()\n\t\t\t{\n\t\t\t\tsuper.connectedCallback();\n\t\t\t\tlm.ConnectMouseEvents(this, this, {\n\t\t\t\t\thandleClick: true,\n\t\t\t\t\thandleMouseWheel: true,\n\t\t\t\t});\n\t\t\t}\n\t\t\tdisconnectedCallback() {\n\t\t\t\tlm.DisconnectMouseEvents(this, this);\n\t\t\t\tsuper.disconnectedCallback();\n\t\t\t}\n\n\t\tThe following functions must be implemented in callbackObj to handle this binding:\n\t\t\tOnMouseDown(event, where);\n\t\t\tOnMouseMove(event, where, isMouseDown);\n\t\t\tOnMouseUp(event, where);\n\t\t\tOnClick(event, where); // optional - see options\n\t\t\tOnDoubleClick(event, where); // optional - see options\n\t\t\tOnMouseWheel(event, where); // optional - see options\n*/\nlm.ConnectMouseEvents = function(domElement, callbackObj, options)\n{\n\toptions = lm.Default(options, {});\n\toptions.handleClick = lm.Default(options.handleClick, false);\n\toptions.handleDoubleClick = lm.Default(options.handleDoubleClick, false);\n\toptions.handleMouseWheel = lm.Default(options.handleMouseWheel, false);\n\toptions.ignoreTouch = lm.Default(options.ignoreTouch, false);\n\toptions.preventDefault = lm.Default(options.preventDefault, true);\n\n\tcallbackObj._mouseState = {\n\t\t// mouseDownCount: 0,\n\t\tmouseDown: false,\n\t\tmousePoint: { x: 0, y: 0 },\n\t\tmouseDownPoint: { x: 0, y: 0 },\n\t\toptions: options,\n\t\tcallbacks: new Map(),\n\t};\n\n\tlet mouseDownCallback = function(e)\n\t{\n\t\tif (!e)\n\t\t\te = event;\n\t\tif (callbackObj._mouseState.options.preventDefault)\n\t\t\te.preventDefault();\n\t\t// callbackObj._mouseState.mouseDownCount++;\n\t\tcallbackObj._mouseState.mouseDown = true;\n\t\tcallbackObj._mouseState.possibleClick = callbackObj._mouseState.options.handleClick;\n\t\tcallbackObj._mouseState.mousePoint = lm.PageToElemCoords(domElement, e.pageX, e.pageY);\n\t\tcallbackObj._mouseState.mouseDownPoint.x = callbackObj._mouseState.mousePoint.x;\n\t\tcallbackObj._mouseState.mouseDownPoint.y = callbackObj._mouseState.mousePoint.y;\n\t\tcallbackObj.OnMouseDown(e, callbackObj._mouseState.mousePoint);\n\t};\n\tcallbackObj._mouseState.callbacks.set(\"mousedown\", { elem: domElement, func: mouseDownCallback });\n\tdomElement.addEventListener(\"mousedown\", mouseDownCallback, false);\n\n\t// This mousemove handler is for when the mouse button is not down, and the mouse moves over the domElement.\n\tlet mouseMoveHandler = function(e)\n\t{\n\t\tif (callbackObj._mouseState.mouseDown)\n\t\t\treturn;\n\t\tif (!e)\n\t\t\te = event;\n\t\tcallbackObj._mouseState.mousePoint = lm.PageToElemCoords(domElement, e.pageX, e.pageY);\n\t\tif (lm.Abs(callbackObj._mouseState.mousePoint.x - callbackObj._mouseState.mouseDownPoint.x) > 6 ||\n\t\t\tlm.Abs(callbackObj._mouseState.mousePoint.y - callbackObj._mouseState.mouseDownPoint.y) > 6)\n\t\t{\n\t\t\tcallbackObj._mouseState.possibleClick = false;\n\t\t}\n\t\tcallbackObj.OnMouseMove(e, callbackObj._mouseState.mousePoint, callbackObj._mouseState.mouseDown);\n\t}\n\tcallbackObj._mouseState.callbacks.set(\"mousemove\", { elem: domElement, func: mouseMoveHandler });\n\tdomElement.addEventListener(\"mousemove\", mouseMoveHandler, false);\n\n\t// This mousemove handler is more global, and is for when the mouse button is down, and mouse input has been \"captured\" by the domElement.\n\tlet mouseDragHandler = function(e)\n\t{\n\t\tif (!callbackObj._mouseState.mouseDown)\n\t\t\treturn;\n\t\tif (!e)\n\t\t\te = event;\n\t\tcallbackObj._mouseState.mousePoint = lm.PageToElemCoords(domElement, e.pageX, e.pageY);\n\t\tif (lm.Abs(callbackObj._mouseState.mousePoint.x - callbackObj._mouseState.mouseDownPoint.x) > 6 ||\n\t\t\tlm.Abs(callbackObj._mouseState.mousePoint.y - callbackObj._mouseState.mouseDownPoint.y) > 6)\n\t\t{\n\t\t\tcallbackObj._mouseState.possibleClick = false;\n\t\t}\n\t\tcallbackObj.OnMouseMove(e, callbackObj._mouseState.mousePoint, callbackObj._mouseState.mouseDown);\n\t};\n\tcallbackObj._mouseState.callbacks.set(\"mousemove\", { elem: document, func: mouseDragHandler });\n\tdocument.addEventListener(\"mousemove\", mouseDragHandler, false);\n\n\t// The mouseup handler is kind of global, but only gets processed if there was actually a mousedown event in this domElement.\n\tlet mouseUpHandler = function(e)\n\t{\n\t\tif (!callbackObj._mouseState.mouseDown)\n\t\t\treturn;\n\t\tif (!e)\n\t\t\te = event;\n\t\t// callbackObj._mouseState.mouseDownCount--;\n\t\t// if (callbackObj._mouseState.mouseDownCount < 1)\n\t\t\tcallbackObj._mouseState.mouseDown = false;\n\t\t// if (callbackObj._mouseState.mouseDownCount < 0)\n\t\t// \tlm.ErrorLog(\"Unexpected: mouseDownCount < 0\");\n\t\tcallbackObj._mouseState.mousePoint = lm.PageToElemCoords(domElement, e.pageX, e.pageY);\n\t\tcallbackObj.OnMouseUp(e, callbackObj._mouseState.mousePoint);\n\t\tif (callbackObj._mouseState.possibleClick)\n\t\t\tcallbackObj.OnClick(e, callbackObj._mouseState.mousePoint);\n\t};\n\tcallbackObj._mouseState.callbacks.set(\"mouseup\", { elem: document, func: mouseUpHandler });\n\tdocument.addEventListener(\"mouseup\", mouseUpHandler, false);\n\n\t// This code works, but instead of installing a click handler, we'll handle clicks ourselves inside of mouseUp\n\t// if (callbackObj._mouseState.options.handleClick)\n\t// {\n\t// \tlet clickHandler = function(e)\n\t// \t{\n\t// \t\tif (!e)\n\t// \t\t\te = event;\n\t// \t\tif (callbackObj._mouseState.options.preventDefault)\n\t// \t\t\te.preventDefault();\n\t// \t\tcallbackObj._mouseState.mousePoint = lm.PageToElemCoords(domElement, e.pageX, e.pageY);\n\t// \t\tif (callbackObj._mouseState.possibleClick)\n\t// \t\t\tcallbackObj.OnClick(e, callbackObj._mouseState.mousePoint);\n\t// \t};\n\t// \tcallbackObj._mouseState.callbacks.set(\"click\", { elem: domElement, func: clickHandler });\n\t// \tdomElement.addEventListener(\"click\", clickHandler, false);\n\t// }\n\n\tif (callbackObj._mouseState.options.handleMouseWheel)\n\t{\n\t\tlet mouseWheelHandler = function(e)\n\t\t{\n\t\t\tif (!e)\n\t\t\t\te = event;\n\t\t\tif (callbackObj._mouseState.options.preventDefault)\n\t\t\t\te.preventDefault();\n\t\t\tcallbackObj._mouseState.mousePoint = lm.PageToElemCoords(domElement, e.pageX, e.pageY);\n\t\t\tcallbackObj.OnMouseWheel(e, callbackObj._mouseState.mousePoint);\n\t\t};\n\t\tcallbackObj._mouseState.callbacks.set(\"mousewheel\", { elem: domElement, func: mouseWheelHandler });\n\t\tdomElement.addEventListener(\"mousewheel\", mouseWheelHandler, false);\n\t}\n\n\tif (callbackObj._mouseState.options.handleDoubleClick)\n\t{\n\t\tlet doubleClickHandler = function(e)\n\t\t{\n\t\t\tif (!e)\n\t\t\t\te = event;\n\t\t\tif (callbackObj._mouseState.options.preventDefault)\n\t\t\t\te.preventDefault();\n\t\t\tcallbackObj._mouseState.mousePoint = lm.PageToElemCoords(domElement, e.pageX, e.pageY);\n\t\t\tcallbackObj.OnDoubleClick(e, callbackObj._mouseState.mousePoint);\n\t\t};\n\t\tcallbackObj._mouseState.callbacks.set(\"dblclick\", { elem: domElement, func: doubleClickHandler });\n\t\tdomElement.addEventListener(\"dblclick\", doubleClickHandler, false);\n\t}\n\n\tlet touchStartHandler = function(e)\n\t{\n\t\tif (!e)\n\t\t\te = event;\n\t\tif (callbackObj._mouseState.options.ignoreTouch)\n\t\t{\n\t\t\tif (e.touches && e.touches.length > 0 && e.touches[0].touchType == \"direct\")\n\t\t\t\treturn;\n\t\t}\n\t\tif (callbackObj._mouseState.options.preventDefault)\n\t\t\te.preventDefault();\n\t\t// callbackObj._mouseState.mouseDownCount++;\n\t\tif (e.touches && e.touches.length > 1)\n\t\t\tcallbackObj._mouseState.possibleClick = false;\n\t\tlet possibleClick = callbackObj._mouseState.possibleClick;\n\t\tcallbackObj._mouseState.mouseDown = true;\n\t\tcallbackObj._mouseState.possibleClick = callbackObj._mouseState.options.handleClick;\n\t\tcallbackObj._mouseState.mousePoint = lm.PageToElemCoords(domElement, e.targetTouches[0].pageX, e.targetTouches[0].pageY);\n\t\tcallbackObj._mouseState.mouseDownPoint.x = callbackObj._mouseState.mousePoint.x;\n\t\tcallbackObj._mouseState.mouseDownPoint.y = callbackObj._mouseState.mousePoint.y;\n\t\tif (callbackObj._mouseState.options.handleDoubleClick)\n\t\t{\n\t\t\tif (!callbackObj._mouseState.doubleTapTimer)\n\t\t\t\tcallbackObj._mouseState.doubleTapTimer = new lm.Stopwatch();\n\t\t\telse if (callbackObj._mouseState.doubleTapTimer.ElapsedTime() < 1.0 && possibleClick)\n\t\t\t{\n\t\t\t\tif (lm.Abs(callbackObj._mouseState.mousePoint.x - callbackObj._mouseState.lastDoubleTapPoint.x) < 128 &&\n\t\t\t\t\tlm.Abs(callbackObj._mouseState.mousePoint.y - callbackObj._mouseState.lastDoubleTapPoint.y) < 128)\n\t\t\t\t{\n\t\t\t\t\tcallbackObj.OnDoubleClick(e, callbackObj._mouseState.mousePoint);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tcallbackObj._mouseState.doubleTapTimer.Start();\n\t\t\tcallbackObj._mouseState.lastDoubleTapPoint = { x: callbackObj._mouseState.mousePoint.x, y: callbackObj._mouseState.mousePoint.y };\n\t\t}\n\t\tcallbackObj.OnMouseDown(e, callbackObj._mouseState.mousePoint);\n\t};\n\tcallbackObj._mouseState.callbacks.set(\"touchstart\", { elem: domElement, func: touchStartHandler });\n\tdomElement.addEventListener(\"touchstart\", touchStartHandler, false);\n\n\tlet touchMoveHandler = function(e)\n\t{\n\t\tif (!callbackObj._mouseState.mouseDown)\n\t\t\treturn;\n\t\tif (!e)\n\t\t\te = event;\n\t\tif (callbackObj._mouseState.options.ignoreTouch)\n\t\t{\n\t\t\tif (e.touches && e.touches.length > 0 && e.touches[0].touchType == \"direct\")\n\t\t\t\treturn;\n\t\t}\n\t\tif (callbackObj._mouseState.options.preventDefault)\n\t\t\te.preventDefault();\n\t\tcallbackObj._mouseState.mousePoint = lm.PageToElemCoords(domElement, e.targetTouches[0].pageX, e.targetTouches[0].pageY);\n\t\tif (lm.Abs(callbackObj._mouseState.mousePoint.x - callbackObj._mouseState.mouseDownPoint.x) > 6 ||\n\t\t\tlm.Abs(callbackObj._mouseState.mousePoint.y - callbackObj._mouseState.mouseDownPoint.y) > 6)\n\t\t{\n\t\t\tcallbackObj._mouseState.possibleClick = false;\n\t\t}\n\t\tcallbackObj.OnMouseMove(e, callbackObj._mouseState.mousePoint, callbackObj._mouseState.mouseDown);\n\t};\n\tcallbackObj._mouseState.callbacks.set(\"touchmove\", { elem: domElement, func: touchMoveHandler });\n\tdomElement.addEventListener(\"touchmove\", touchMoveHandler, false);\n\n\tlet touchEndHandler = function(e)\n\t{\n\t\tif (!callbackObj._mouseState.mouseDown)\n\t\t\treturn;\n\t\tif (!e)\n\t\t\te = event;\n\t\tif (callbackObj._mouseState.options.ignoreTouch)\n\t\t{\n\t\t\tif (e.touches && e.touches.length > 0 && e.touches[0].touchType == \"direct\")\n\t\t\t\treturn;\n\t\t}\n\t\t// callbackObj._mouseState.mouseDownCount--;\n\t\t// if (callbackObj._mouseState.mouseDownCount < 1)\n\t\t\tcallbackObj._mouseState.mouseDown = false;\n\t\t// if (callbackObj._mouseState.mouseDownCount < 0)\n\t\t// \tlm.ErrorLog(\"Unexpected: mouseDownCount < 0\");\n\t\tcallbackObj.OnMouseUp(e, callbackObj._mouseState.mousePoint);\n\t\tif (callbackObj._mouseState.possibleClick)\n\t\t\tcallbackObj.OnClick(e, callbackObj._mouseState.mousePoint);\n\t};\n\tcallbackObj._mouseState.callbacks.set(\"touchend\", { elem: domElement, func: touchEndHandler });\n\tdomElement.addEventListener(\"touchend\", touchEndHandler, false);\n\n\tlet touchCancelHandler = function(e)\n\t{\n\t\tif (!callbackObj._mouseState.mouseDown)\n\t\t\treturn;\n\t\tif (!e)\n\t\t\te = event;\n\t\tif (callbackObj._mouseState.options.ignoreTouch)\n\t\t{\n\t\t\tif (e.touches && e.touches.length > 0 && e.touches[0].touchType == \"direct\")\n\t\t\t\treturn;\n\t\t}\n\t\t// callbackObj._mouseState.mouseDownCount--;\n\t\t// if (callbackObj._mouseState.mouseDownCount < 1)\n\t\t\tcallbackObj._mouseState.mouseDown = false;\n\t\t// if (callbackObj._mouseState.mouseDownCount < 0)\n\t\t// \tlm.ErrorLog(\"Unexpected: mouseDownCount < 0\");\n\t\tcallbackObj.OnMouseUp(e, callbackObj._mouseState.mousePoint);\n\t\tif (callbackObj._mouseState.possibleClick)\n\t\t\tcallbackObj.OnClick(e, callbackObj._mouseState.mousePoint);\n\t};\n\tcallbackObj._mouseState.callbacks.set(\"touchcancel\", { elem: domElement, func: touchCancelHandler });\n\tdomElement.addEventListener(\"touchcancel\", touchCancelHandler, false);\n}\n\n/*\n\tFunction: lm.DisconnectMouseEvents\n\t\tDisconnects the mouse handling callbacks that were previously set up by a call to lm.ConnectMouseEvents().\n*/\nlm.DisconnectMouseEvents = function(callbackObj)\n{\n\tif (!callbackObj || !callbackObj._mouseState || !callbackObj._mouseState.callbacks)\n\tfor (let [key, value] of callbackObj._mouseState.callbacks)\n\t{\n\t\tvalue.elem.removeEventListener(key, value.func);\n\t}\n}\n"],"names":["lm","AllowTabsInTextArea","elem","onkeydown","ev","keyCode","which","event","preventDefault","v","this","value","s","selectionStart","e","selectionEnd","console","log","newValue","substring","PageToElemCoords","pageX","pageY","box","getBoundingClientRect","body","document","docElem","documentElement","scrollTop","window","pageYOffset","scrollLeft","pageXOffset","clientTop","clientLeft","top","Math","round","x","left","y","ElemPageOffset","PagePointInElem","pt","offsetWidth","offsetHeight","IsTextBox","tagName","toLowerCase","type","getAttribute","indexOf","ToggleDropdown","id","getElementById","Assert","showing","classList","contains","style","opacity","FadeOut","toggle","DropdownShowingChange","FadeIn","ToggleVisibility","visible","visibility","secs","callback","display","timer","setInterval","clearInterval","toFixed","InputHasFocus","hasFocus","activeElement","elType","nodeName","ToggleFullscreen","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","cancelFullScreen","mozCancelFullScreen","webkitCancelFullScreen","_element","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","Element","ALLOW_KEYBOARD_INPUT","E","ConnectMouseEvents","domElement","callbackObj","options","Default","handleClick","handleDoubleClick","handleMouseWheel","ignoreTouch","_mouseState","mouseDown","mousePoint","mouseDownPoint","callbacks","Map","mouseDownCallback","possibleClick","OnMouseDown","set","func","addEventListener","mouseMoveHandler","Abs","OnMouseMove","mouseDragHandler","mouseUpHandler","OnMouseUp","OnClick","mouseWheelHandler","OnMouseWheel","doubleClickHandler","OnDoubleClick","touchStartHandler","touches","length","touchType","targetTouches","doubleTapTimer","ElapsedTime","lastDoubleTapPoint","Stopwatch","Start","touchMoveHandler","touchEndHandler","touchCancelHandler","DisconnectMouseEvents","key","removeEventListener"],"version":3,"file":"index.f7cbb0de.js.map"}